<section class="container">
  <!-- En-tête de page avec titre et sous-titre -->
  <header class="page-header">
    <h2>Patrimoines de Tunisie</h2>
    <p class="muted">Sélection de sites historiques & culturels</p>
  </header>

  <!-- Barre de filtres et de contrôles -->
  <div class="filter-bar card-surface p-3 mb-4">
    <div class="row g-2 align-items-center">
      <!-- Champ de recherche textuelle -->
      <div class="col-12 col-md-4">
        <input
          #searchBox
          type="text"
          class="form-control"
          placeholder="Recherche (nom ou localisation)"
          [value]="search()"
          (input)="setSearch(searchBox.value)"
        />
      </div>
      
      <!-- Sélecteur de catégorie -->
      <div class="col-6 col-md-3">
        <select
          #categorySel
          class="form-select"
          [value]="category()"
          (change)="setCategory(categorySel.value)"
        >
          <option value="">Toutes catégories</option>
          @for (c of categories(); track c) { <option [value]="c">{{ c }}</option> }
        </select>
      </div>
      
      <!-- Boutons de tri alphabétique -->
      <div class="col-6 col-md-3 d-flex gap-2 sort-buttons">
        <button class="btn btn-sm btn-outline-info" [class.active]="sortMode() === 'alpha'" (click)="setSort('alpha')">A→Z</button>
        <button class="btn btn-sm btn-outline-info" [class.active]="sortMode() === 'reverse'" (click)="setSort('reverse')">Z→A</button>
        <button class="btn btn-sm btn-outline-secondary" [class.active]="sortMode() === 'none'" (click)="setSort('none')">Reset</button>
      </div>
      
      <!-- Compteur de résultats et modes d'affichage -->
      <div class="col-12 col-md-2 text-md-end mt-2 mt-md-0 d-flex flex-column align-items-md-end gap-1">
        <span class="badge bg-info-subtle text-info-emphasis">{{ filteredPatrimoines().length }} résultat(s)</span>
        <div class="view-toggle">
          <button type="button" class="btn btn-xs" [class.active]="viewMode() === 'grid'" (click)="setView('grid')">Grille</button>
          <button type="button" class="btn btn-xs" [class.active]="viewMode() === 'list'" (click)="setView('list')">Liste</button>
          <button type="button" class="btn btn-xs" [class.active]="dense()" (click)="toggleDense()" title="Mode compact">Compact</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bloc conditionnel: affichage selon état (chargement, erreur, succès) -->
  @if (loading()) {
    <!-- Squelettes de chargement (skeleton screens) -->
    <div class="skeleton-grid">
      @for (i of [0,1,2,3,4,5,6,7]; track i) {
        <div class="skeleton-card"></div>
      }
    </div>
  } @else if (error()) {
    <!-- Affichage du message d'erreur -->
    <div class="error">{{ error() }}</div>
  } @else {
    <!-- Résultats de recherche -->
    @if (filteredPatrimoines().length === 0) {
      <!-- Message d'absence de résultats -->
      <div class="alert alert-secondary">Aucun patrimoine ne correspond aux filtres.</div>
    } @else {
      <!-- Grille ou liste de cartes patrimoniales avec animation en cascade -->
      <div
        class="grid"
        [class.list]="viewMode() === 'list'"
        [class.dense]="dense()"
        [@listStagger]
      >
        @for (p of filteredPatrimoines(); track p.id) {
          <app-patrimoine-card [patrimoine]="p" />
        }
      </div>
    }
  }
</section>