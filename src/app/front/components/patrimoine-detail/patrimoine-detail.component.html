<section class="container" [@pageFade]>
  <a routerLink="/patrimoines" class="back">← Retour à la liste</a>

  @if (loading) {
  <div class="detail-skeleton">
    <div class="hero-skel shimmer"></div>
    <div class="panels-skel">
      <div class="panel-skel shimmer"></div>
      <div class="panel-skel shimmer"></div>
      <div class="panel-skel shimmer"></div>
    </div>
  </div>
  } @else { @if (error) {
  <div class="error">{{ error }}</div>
  } @else if (patrimoine) {
  <header class="hero">
    <div class="media">
      @if (patrimoine.photoCarousel.length) {
      <app-carousel [images]="patrimoine.photoCarousel" height="360px" />
      } @else {
      <img [src]="'/images/placeholder.webp'" [alt]="patrimoine.nom" />
      }
    </div>
    <div class="meta">
      <h2>{{ patrimoine.nom }}</h2>
      <p class="muted">{{ patrimoine.localisation }}</p>
      <div class="chips">
        @for (cat of patrimoine.categories; track cat) { <span class="chip">{{ cat }}</span> }
      </div>
    </div>
  </header>

  <div class="details">
    <div class="panel">
      <h3>À propos</h3>
      <p>{{ patrimoine.description }}</p>
      @if (patrimoine.origineHistorique) {
      <p class="muted">Origine: {{ patrimoine.origineHistorique }}</p>
      }
      <ul class="grid-info">
        <li><strong>Ouvert:</strong> {{ patrimoine.ouvert ? 'Oui' : 'Non' }}</li>
        <li><strong>Prix d'entrée:</strong> {{ patrimoine.prixEntree | number : '1.0-2' }} DT</li>
        <li><strong>Classé:</strong> {{ patrimoine.estClasse ? 'Oui' : 'Non' }}</li>
        <li>
          <strong>Visites guidées:</strong>
          {{ patrimoine.visitesGuideesDisponibles ? 'Oui' : 'Non' }}
        </li>
        <li><strong>Date de construction:</strong> {{ patrimoine.dateConstruction || '—' }}</li>
      </ul>
    </div>

    <div class="panel">
      <h3>Horaires</h3>
      <ul>
        @for (h of patrimoine.horaires; track h) {
        <li>{{ h }}</li>
        }
      </ul>
    </div>

    <div class="panel">
      <h3>Lieux proches</h3>
      <ul>
        @for (l of patrimoine.lieuxProches; track l.nom) {
        <li>
          {{ l.nom }} — <span class="muted">{{ l.type }}</span> @if (l.distanceKm) {
          <span class="muted">• {{ l.distanceKm }} km</span> }
        </li>
        }
      </ul>
    </div>

    <div class="panel">
      <h3>Statistiques</h3>
      <ul class="stats-grid">
        <li><strong>Vues:</strong> {{ patrimoine.stats?.vues ?? 0 }}</li>
        <li><strong>Favoris:</strong> {{ patrimoine.stats?.favoris ?? 0 }}</li>
        <li><strong>Note moyenne:</strong> {{ patrimoine.stats?.noteMoyenne ?? 0 }} / 5</li>
      </ul>
    </div>

    <div class="panel">
      <h3>Commentaires</h3>
      @if (patrimoine.comments.length) {
      <ul class="comments">
        @for (c of patrimoine.comments; track c.id) {
        <li>
          <div class="d-flex justify-content-between">
            <strong>{{ c.nom }}</strong>
            <span class="date">{{ c.date }}</span>
          </div>
          @if (c.note) {
          <div class="note">Note: {{ c.note }} / 5</div>
          }
          <div>{{ c.message }}</div>
        </li>
        }
      </ul>
      } @else {
      <div class="muted">Aucun commentaire pour le moment.</div>
      }
    </div>

    <div class="panel">
      <h3>Localisation</h3>
      @if (patrimoine.latitude && patrimoine.longitude) {
      <div class="map-frame">
        <iframe
          title="Carte"
          [src]="
            'https://www.google.com/maps?q=' +
              patrimoine.latitude +
              ',' +
              patrimoine.longitude +
              '&hl=fr&z=14&output=embed' | safeUrl
          "
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
        ></iframe>
      </div>
      } @else {
      <div class="muted">Coordonnées indisponibles.</div>
      }
    </div>
  </div>

  <section class="monuments">
    <h3>Monuments</h3>
    <div class="grid">
      @for (m of patrimoine.monuments; track m.id) {
      <a class="monument-card" [routerLink]="['/patrimoines', patrimoine!.id, 'monuments', m.id]">
        <img [src]="m.photoCarousel[0]" [alt]="m.nom" />
        <div class="content">
          <h4>{{ m.nom }}</h4>
          <p class="muted">{{ m.categories.join(', ') }}</p>
        </div>
      </a>
      }
    </div>
  </section>

  } }
</section>
